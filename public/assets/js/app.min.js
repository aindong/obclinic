!function(e,t,a){"use strict";toastr.options={closeButton:!0,debug:!1,positionClass:"toast-bottom-right",onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},e("#main-menu > li").not(".gui-folder").click(function(){App.Helpers.Loader.show(),e(this).addClass("active").siblings().removeClass("active")}),e("#main-menu li ul li").click(function(){App.Helpers.Loader.show();var t=e(this).parent().parent();t.hasClass("active")||t.addClass("active").siblings().removeClass("active")}),e("#main-menu a").on("click",function(e){t.history.loadUrl(t.history.fragment)}),Handlebars.registerHelper("years",function(e){for(var t="",a=new Date,n=1950;n<=a.getFullYear();++n)t+=e.fn(n);return t}),window.App={Helpers:{},Models:{},Views:{Maintenance:{}},Collections:{}}}(jQuery,Backbone,Marionette),App.Helpers.Http=function(e){"use strict";var t={};return t.getTemplate=function(e){},t.post=function(t,a,n,i){var r=t,s=a,o=e(".btn-loading-state");return e.ajax({url:n,type:"POST",data:s.serialize(),beforeSend:function(){o.button("loading")},success:function(e){"success"==e.status?(toastr.success(i.success,"Success"),r.triggerMethod("render")):toastr.error(i.failed,"Error")},error:function(){toastr.error(i.failed,"Error")},complete:function(){o.button("reset")}}),this},t}(jQuery),App.Helpers.Images=function(e){"use strict";function t(e,t,a){var n=document.createElement("canvas"),i=n.getContext("2d"),r=new Image;r.crossOrigin="Anonymous",r.onload=function(){n.height=r.height,n.width=r.width,i.drawImage(r,0,0);var e=n.toDataURL(a||"image/png");t.call(this,e),n=null},r.source=e}return{ImgToBase64:t}}(window.App),App.Helpers.Loader=function(){var e={};return e.show=function(){$("#loader").show()},e.hide=function(){$("#loader").hide()},e}(),App.Helpers.Table=function(e){"use strict";var t,a=function(){},n=a.prototype;return n.initialize=function(e,t){this._initDataTables(e,t)},n._initDataTables=function(e,t){$.isFunction($.fn.dataTable)&&this._createDataTable(e,t)},n._createDataTable=function(e,a){$.fn.dataTable.isDataTable(e)?(t=e.DataTable(),t.ajax.reload()):t=e.DataTable({dom:'T<"clear">lfrtip',ajax:e.data("source"),columns:a,tableTools:{sSwfPath:e.data("swftools")},order:[[1,"asc"]],language:{lengthMenu:"_MENU_ entries per page",search:'<i class="fa fa-search"></i>',paginate:{previous:'<i class="fa fa-angle-left"></i>',next:'<i class="fa fa-angle-right"></i>'}}})},n._formatDetails=function(e){return'<table cellpadding="5" cellspacing="0" border="0" style="padding-left:50px;"><tr><td>Full name:</td><td>'+e.name+"</td></tr><tr><td>Extension number:</td><td>"+e.extn+"</td></tr><tr><td>Extra info:</td><td>And any further details here (images etc)...</td></tr></table>"},n}(window.App),App.Models.Allergy=function(e){"use strict";var t=Backbone.Model.extend({"default":{type:"",name:""}});return t}(window.App),App.Models.Patient=function(e){"use strict";var t=Backbone.Model.extend({defaults:{patient_no:"",firstname:"Ann",lastname:"Laurens",middlename:"M",address:"795 Folsom Ave, San Francisco, CA 94107",birthdate:"",contactno:"567-890-1234",email:"ann@laurens.com",picture:"avatar9463a.jpg"}});return t}(window.App),App.Models.Queue=function(e){"use strict";var t=Backbone.Model.extend({"default":{id:"",arrival:"",patient_no:"",vitalsign_id:"",reservation_type:""}});return t}(window.App),App.Collections.Patients=function(e){"use strict";var t=Backbone.Collection.extend({model:e.Models.Patient,url:"/api/v1/patients",pagination:{current_page:1,total_data:0,per_page:0,total_page:0},parse:function(e){return this.pagination.current_page=e.current_page,this.pagination.total_data=e.total,this.pagination.per_page=e.per_page,this.pagination.total_page=e.total/e.per_page,e.data}});return t}(window.App),App.Views.Appointments=function(e){"use strict";var t=Marionette.View.extend({el:$("#content"),initialize:function(){},render:function(){var t=this;$.get("/assets/templates/appointments/index.tpl.html",function(a){var n=Handlebars.compile(a);$.get("/api/v1/patients?q=all",function(a){t.$el.html(n({data:a})),t.triggerMethod("render"),$("select").select2();var i=document.querySelector("#appointmentForm");return i.addEventListener("submit",_.bind(t.createAppointment,t)),e.Helpers.Loader.hide(),t})})},onRender:function(){var t=[{"class":"details-control",orderable:!1,data:null,defaultContent:""},{data:"id"},{data:"patient_no"},{data:"name"},{data:"appointment_date"},{data:"status"},{data:"created_by"},{data:"actions"}];e.Helpers.Table.initialize($("#datatable2"),t)},createAppointment:function(t){t.preventDefault();var a=$("#appointmentForm"),n="/api/v1/appointments",i={success:"Successfully created a new appointment",failed:"Failed to add a new appointment"},r=e.Helpers.Http;r.post(this,a,n,i)}});return{List:t}}(window.App),App.Views.Patients=function(e){"use strict";var t=new e.Collections.Patients,a=Marionette.View.extend({el:"#createForm",events:{submit:"createPatient"},createPatient:function(e){e.preventDefault();var t=this.collection.create({patient_no:this.$("#patient_no").val(),firstname:this.$("#firstname").val(),lastname:this.$("#lastname").val(),middlename:this.$("#middlename").val(),address:this.$("#address").val(),birthdate:this.$("#birthdate").val(),contactno:this.$("#contactno").val(),email:this.$("#email").val()},{wait:!0});console.log(t)}}),n=Marionette.View.extend({el:$("#content"),initialize:function(e){e.page&&(this.page=e.page),this.collection.on("sync",this.render,this);new a({collection:t})},collection:t,render:function(){var t=this;$.get("/assets/templates/patients/index.tpl.html",function(a){for(var n=Handlebars.compile(a),i={pages:[],current:t.collection.pagination.current_page,last:t.collection.pagination.total_page},r=1;r<=t.collection.pagination.total_page;r++){var s;s='<li><a href="#patients/'+r+'">'+r+"</a></li>",r==t.collection.pagination.current_page&&(s='<li class="active"><a href="#patients/'+r+'">'+r+' <span class="sr-only">(current)</span></a></li>'),i.pages.push(s)}var o=n({patients:t.collection.toJSON(),pagination:i});return t.$el.html(o),e.Helpers.Loader.hide(),t})},onBeforeRender:function(){var e=this;this.collection.fetch({data:{page:this.page}}).then(function(){e.triggerMethod("render")})},onRender:function(){console.log("rendered"),this.render()}}),i=Marionette.View.extend({el:$("#content"),patient_no:null,initialize:function(e){e.patient_no&&(this.patient_no=e.patient_no)},render:function(){var t=this;$.get("/assets/templates/patients/show.tpl.html",function(a){var n=Handlebars.compile(a),i=n({});t.$el.html(i),$("select").select2(),t.triggerMethod("render"),e.Helpers.Loader.hide()})},onBeforeRender:function(){this.render()},onRender:function(){$("#createAllergyForm").on("submit",r),$("#createPastMedicalHistoryForm").on("submit",s),$("#createCurrentMedicationForm").on("submit",o)}}),r=function(e){e.preventDefault();var t=$("#allergyList"),a=$("#allergies"),n="<li>"+a.val()+"</li>";t.append(n)},s=function(e){e.preventDefault();var t=$("#pastMedicalHistoryList"),a=$("#disease"),n=$("#diagnosed"),i="<li>"+a.val()+" - "+n.val()+"</li>";t.append(i)},o=function(e){e.preventDefault()};return{List:n,Show:i}}(window.App),App.Views.Queues=function(e){"use strict";var t=Marionette.View.extend({el:$("#content"),initialize:function(){},render:function(){var t=this;$.get("/assets/templates/queues/index.tpl.html",function(a){var n=Handlebars.compile(a);$.get("/api/v1/patients?q=all",function(a){t.$el.html(n({data:a})),t.triggerMethod("render"),$("select").select2();var i=document.querySelector("#createQueueForm");return i.addEventListener("submit",_.bind(t.createQueue,t)),e.Helpers.Loader.hide(),t})})},onRender:function(){var t=[{"class":"details-control",orderable:!1,data:null,defaultContent:""},{data:"queue_no"},{data:"arrival"},{data:"patient_id"},{data:"patient_name"},{data:"vitalsign"},{data:"type"}];e.Helpers.Table.initialize($("#datatable2"),t)},createQueue:function(t){t.preventDefault();var a=$("#createQueueForm"),n="/api/v1/queues",i={success:"Successfully added a new patient on the queue",faled:"Failed to add a new patient on the queue"},r=e.Helpers.Http;r.post(this,a,n,i)}});return{List:t}}(window.App),App.Views.Maintenance.Allergies=function(e){"use strict";var t=Marionette.View.extend({el:$("#content"),initialize:function(){},render:function(){var t=this;$.get("/assets/templates/allergies/index.tpl.html",function(a){var n=Handlebars.compile(a);t.$el.html(n),t.triggerMethod("render"),$("select").select2();var i=document.querySelector("#allergiesForm");return i.addEventListener("submit",_.bind(t.createAllergy,t)),e.Helpers.Loader.hide(),t})},onRender:function(){var t=[{"class":"details-control",orderable:!1,data:null,defaultContent:""},{data:"id"},{data:"type"},{data:"name"},{data:"created"},{data:"updated"},{data:"actions"}];e.Helpers.Table.initialize($("#datatable2"),t)},createAllergy:function(t){t.preventDefault();var a=$("#allergiesForm"),n="/api/v1/maintenance/allergies",i={success:"Successfully created a new allergy",failed:"Failed to add a new allergy"},r=e.Helpers.Http;r.post(this,a,n,i)}});return{List:t}}(window.App),App.Views.Maintenance.Diseases=function(e){"use strict";var t=Marionette.View.extend({el:$("#content"),initialize:function(){},render:function(){var t=this;$.get("/assets/templates/diseases/index.tpl.html",function(a){var n=Handlebars.compile(a);t.$el.html(n),t.triggerMethod("render");var i=document.querySelector("#diseasesForm");return i.addEventListener("submit",_.bind(t.createDisease,t)),e.Helpers.Loader.hide(),t})},onRender:function(){var t=[{"class":"details-control",orderable:!1,data:null,defaultContent:""},{data:"id"},{data:"name"},{data:"created"},{data:"updated"},{data:"actions"}];e.Helpers.Table.initialize($("#datatable2"),t)},createDisease:function(t){t.preventDefault();var a=$("#diseasesForm"),n="/api/v1/maintenance/diseases",i={success:"Successfully added a disease",failed:"Failed to add a new disease"},r=e.Helpers.Http;r.post(this,a,n,i)}});return{List:t}}(window.App),App.Views.Maintenance.Medicines=function(e){"use strict";var t=Marionette.View.extend({el:$("#content"),initialize:function(){},render:function(){var t=this;$.get("/assets/templates/medicines/index.tpl.html",function(a){var n=Handlebars.compile(a);t.$el.html(n),t.triggerMethod("render");var i=document.querySelector("#medicinesForm");return i.addEventListener("submit",_.bind(t.createMedicine,t)),e.Helpers.Loader.hide(),t})},onRender:function(){var t=[{"class":"details-control",orderable:!1,data:null,defaultContent:""},{data:"id"},{data:"name"},{data:"created"},{data:"updated"},{data:"actions"}];e.Helpers.Table.initialize($("#datatable2"),t)},createMedicine:function(t){t.preventDefault();var a=$("#medicinesForm"),n="/api/v1/maintenance/medicines",i={success:"Successfully created a new medicine",failed:"Failed to create a new medicine"},r=e.Helpers.Http;r.post(this,a,n,i)}});return{List:t}}(window.App),App.Views.Maintenance.Users=function(e){"use strict";var t=Marionette.View.extend({el:$("#content"),initialize:function(){},render:function(){var t=this;$.get("/assets/templates/users/users.tpl.html",function(a){var n=Handlebars.compile(a);$.get("/api/v1/maintenance/users/roles",function(a){t.$el.html(n({data:a})),t.triggerMethod("render"),$("select").select2();var i=document.querySelector("#usersForm");return i.addEventListener("submit",_.bind(t.createUser,t)),e.Helpers.Loader.hide(),t})})},onRender:function(){var t=[{"class":"details-control",orderable:!1,data:null,defaultContent:""},{data:"username"},{data:"name"},{data:"role"},{data:"created"},{data:"updated"},{data:"actions"}];e.Helpers.Table.initialize($("#usersTable"),t)},createUser:function(t){t.preventDefault();var a=$("#usersForm"),n="/api/v1/maintenance/users",i={success:"Successfully created a new user",failed:"Failed to create a new user"},r=e.Helpers.Http;r.post(this,a,n,i)}});return{List:t}}(window.App),function(e){"use strict";var t=Backbone.Router.extend({routes:{"":"index","maintenance/users":"showUsers",appointments:"showAppointments",patients:"showPatients","patients/:id/details":"patientDetails","patients/:page":"showPatientsPage","maintenance/allergies":"showAllergies","maintenance/diseases":"showDiseases","maintenance/medicines":"showMedicines","*action":"showQueues"},initialize:function(){Backbone.history.start({pushState:!1})},index:function(){var t=new e.Views.Queues.List;t.render()},showUsers:function(){var t=new e.Views.Maintenance.Users.List;t.render()},showAppointments:function(){var t=new e.Views.Appointments.List;t.render()},showPatients:function(){var t=new e.Views.Patients.List;t.triggerMethod("before:render")},patientDetails:function(t){var a=new e.Views.Patients.Show({patient_no:t});a.triggerMethod("before:render")},showPatientsPage:function(t){var a=new e.Views.Patients.List({page:t});a.triggerMethod("before:render")},showAllergies:function(){var t=new e.Views.Maintenance.Allergies.List;t.render()},showDiseases:function(){var t=new e.Views.Maintenance.Diseases.List;t.render()},showMedicines:function(){var t=new e.Views.Maintenance.Medicines.List;t.render()}});return new t}(window.App);